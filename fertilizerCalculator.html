<!DOCTYPE html>
<html lang="en">

<head>
    <title></title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="css/style.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/brain.js/2.0.0-beta.1/brain-browser.min.js"
        integrity="sha512-MI1PUoQHsMVp8aw45rX19K4o8XlVfPB6jaGlHrj0zUv1ZDnq307ji47GWS1MfUfQDNua43c8vK1iCcuOjMXZBA=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>

</head>

<body>


    <script src="fertilizerTraining.js"></script>
    <script>

        class FertilizerCalculator {
            constructor(data) {
                const [test_data, training_data] = this.sliceArrayInHalf(this.limitToOne(data));
                this.training_data = training_data
                this.test_data = test_data
                this.net = new brain.NeuralNetwork({ hiddenLayers: [3,5] });
                this.trainNeuralNet()
                // console.log(training_data)
                // console.log(test_data)
                this.testNeuralNet()
            }

            devideBy100(val) {
                return Number((Number(val) / 100).toFixed(2));
            }

            limitToOne(data) {
                for (let i = 0; i < data.length; i++) {
                    data[i]['Temparature'] = this.devideBy100(data[i]['Temparature']);
                    data[i]['Humidity'] = this.devideBy100(data[i]['Humidity']);
                    data[i]['Moisture'] = this.devideBy100(data[i]['Moisture']);
                    data[i]['Nitrogen'] = this.devideBy100(data[i]['Nitrogen']);
                    data[i]['Potassium'] = this.devideBy100(data[i]['Potassium']);
                    data[i]['Phosphorous'] = this.devideBy100(data[i]['Phosphorous']);
                    data[i][data[i]['Soil Type']] = 1;
                    data[i][data[i]['Crop Type']] = 1;
                    data[i]['output'] = data[i]['Fertilizer Name'];
                    delete data[i]['Soil Type']
                    delete data[i]['Crop Type']
                    delete data[i]['Fertilizer Name']

                }
                return data;
            }

            sliceArrayInHalf(arr) {
                const middle = Math.floor(arr.length / 2);
                const firstHalf = arr.slice(0, middle);
                const secondHalf = arr.slice(middle);
                return [firstHalf, secondHalf];
            }

            // training the neural net 
            trainNeuralNet() {
                let trainingData = [];
                for (let row in this.training_data) {
                    let output = this.training_data[row]['output']
                    delete this.training_data[row]['output']
                    trainingData.push({
                        input: this.training_data[row],
                        output: { [output]: 1 }
                    })
                }
                let result = this.net.train(trainingData);
                // console.log(result)
            }

            testNeuralNet() {
                let trainingData = [];
                let correct = 0;
                let total = this.test_data.length;
                for (let row in this.test_data) {
                    let output = this.test_data[row]['output']
                    delete this.test_data[row]['output']

                    let result = this.formatNetResult(this.net.run(this.test_data[row]));
                    if(result == output){
                        correct ++;
                    } else{
                        // console.log(result, output)
                    }
                }
                console.log((correct/total * 100).toFixed(0) + " %")
            }

             formatNetResult(data){
                let highestValue = 0;
                let result = "";
                for(let name in data){
                    if(data[name] > highestValue){
                        highestValue = data[name];
                        result = name
                    }
                }

                return result;
            }
        }

        new FertilizerCalculator(JSON.parse(data))

    </script>
</body>

</html>